webpackJsonp([22],{"/7OG":function(e,t,a){t=e.exports=a("FZ+f")(!0),t.push([e.i,".version_detail[data-v-324e5c0e]{padding:20px;min-width:1160px}.version_detail .top[data-v-324e5c0e]{font-size:20px;color:#333;padding-bottom:20px}.version_detail .top a[data-v-324e5c0e]{font-size:14px;line-height:22px;color:#4285f4;vertical-align:middle;padding-left:20px;background:url("+a("7lSi")+") 5px 50% no-repeat}.version_detail .top b[data-v-324e5c0e]{display:inline-block;vertical-align:middle;padding-left:20px;margin-left:20px;border-left:1px solid #cbcbcb}.version_detail .ls .lan[data-v-324e5c0e]{cursor:pointer}.version_detail .ls .el-table[data-v-324e5c0e]{border-left:none}.el-icon-loading[data-v-324e5c0e]{color:#000;margin-right:5px}","",{version:3,sources:["D:/admin/config/src/components/config_center/grayscale_history.vue"],names:[],mappings:"AACA,iCACE,aAAc,AACd,gBAAkB,CACnB,AACD,sCACE,eAAgB,AAChB,WAAY,AACZ,mBAAqB,CACtB,AACD,wCACE,eAAgB,AAChB,iBAAkB,AAClB,cAAe,AACf,sBAAuB,AACvB,kBAAmB,AACnB,0DAAoE,CACrE,AACD,wCACE,qBAAsB,AACtB,sBAAuB,AACvB,kBAAmB,AACnB,iBAAkB,AAClB,6BAA+B,CAChC,AACD,0CACE,cAAgB,CACjB,AACD,+CACE,gBAAkB,CACnB,AACD,kCACE,WAAY,AACZ,gBAAkB,CACnB",file:"grayscale_history.vue",sourcesContent:['\n.version_detail[data-v-324e5c0e] {\n  padding: 20px;\n  min-width: 1160px;\n}\n.version_detail .top[data-v-324e5c0e] {\n  font-size: 20px;\n  color: #333;\n  padding-bottom: 20px;\n}\n.version_detail .top a[data-v-324e5c0e] {\n  font-size: 14px;\n  line-height: 22px;\n  color: #4285f4;\n  vertical-align: middle;\n  padding-left: 20px;\n  background: url("~common/image/icon/arrow_7.png") 5px 50% no-repeat;\n}\n.version_detail .top b[data-v-324e5c0e] {\n  display: inline-block;\n  vertical-align: middle;\n  padding-left: 20px;\n  margin-left: 20px;\n  border-left: 1px solid #cbcbcb;\n}\n.version_detail .ls .lan[data-v-324e5c0e] {\n  cursor: pointer;\n}\n.version_detail .ls .el-table[data-v-324e5c0e] {\n  border-left: none;\n}\n.el-icon-loading[data-v-324e5c0e] {\n  color: #000;\n  margin-right: 5px;\n}'],sourceRoot:""}])},"6s0K":function(e,t,a){"use strict";function i(e){a("d+9i")}Object.defineProperty(t,"__esModule",{value:!0});var s=a("T452"),n={data:function(){return{projectName:"",clusterName:"",serviceName:"",versionName:"",versionId:"",grayName:"",tableData:[],totalCount:0,pageSize:10,currentPage:1,rollbackDialog:!1,rollbackConfList:[],rbSelect:[],isGetting:!1,isGettingText:"回滚"}},methods:{_getGrayscaleConfigHistory:function(){var e=this;Object(s.n)("?project="+this.projectName+"&cluster="+this.clusterName+"&service="+this.serviceName+"&version="+this.versionName+"&gray="+this.grayName+"&currentPage="+this.currentPage+"&pagesize="+this.pageSize).then(function(t){0!==t.code?e.$message({message:t.message?t.message:"获取历史配置失败",type:"error"}):t.data.list&&(e.tableData=t.data.list,e.totalCount=t.data.totalCount)})},handleCurrentChange:function(e){this.currentPage=e,this._getGrayscaleConfigHistory()},rollback:function(e){if(e.histories){this.rollbackConfList=[];var t=[];e.histories.forEach(function(a){t.push({id:a.id,name:a.name,desc:a.desc,version:e.pushVersion,createTime:e.createTime?new Date(e.createTime).Format("yyyy-MM-dd hh:mm:ss"):"暂无"})}),this.rollbackConfList=t,this.rollbackDialog=!0}},rbSelectChange:function(e){this.rbSelect=e},rollbackGrayscaleConf:function(){var e=this;if(this.rbSelect.length){var t=[];this.rbSelect.forEach(function(e){t.push(e.id)}),this.requestIn(),Object(s.w)({ids:t}).then(function(t){if(0!==t.code)e.requestCompleted(),e.$message({message:t.message?t.message:"回滚灰度配置失败",type:"error"});else{if(e.$message({message:t.message?t.message:"回滚灰度配置成功",type:"success"}),t.data){var a=[];t.data.forEach(function(e){a.push(e.id)}),sessionStorage.setItem("RBCONF",a.join(","))}e.$router.push({path:"/main/config/grayscale_group?project="+e.projectName+"&cluster="+e.clusterName+"&service="+e.serviceName+"&version="+e.versionName+"&versionId="+e.versionId})}})}else this.$message({message:"请先选择要回滚的版本",type:"error"})},goback:function(){this.$router.go(-1)},requestIn:function(){this.isGetting=!0,this.isGettingText="处理中"},requestCompleted:function(){this.isGetting=!1,this.isGettingText="确认"}},created:function(){this.projectName=this.$route.query.project,this.clusterName=this.$route.query.cluster,this.serviceName=this.$route.query.service,this.versionName=this.$route.query.version,this.versionId=this.$route.query.versionId,this.grayName=this.$route.query.gray,this._getGrayscaleConfigHistory()}},r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"version_detail"},[a("h2",{staticClass:"top"},[a("a",{attrs:{href:"javascript:;"},on:{click:e.goback}},[e._v("灰度配置")]),e._v(" "),a("b",[e._v("历史配置")])]),e._v(" "),a("div",{staticClass:"ls"},[a("el-table",{staticStyle:{width:"100%"},attrs:{stripe:"",data:e.tableData}},[a("el-table-column",{attrs:{prop:"pushVersion",label:"推送版本"}}),e._v(" "),a("el-table-column",{attrs:{prop:"histories",label:"配置"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.histories,function(t,i){return a("div",{key:i},[a("router-link",{staticClass:"lan",attrs:{to:"/main/config/grayscale_history_version?project="+e.projectName+"&cluster="+e.clusterName+"&service="+e.serviceName+"&version="+e.versionName+"&gray="+e.grayName+"&name="+t.name+"&id="+t.configId}},[e._v(e._s(t.name))])],1)})}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.createTime?new Date(t.row.createTime).Format("yyyy-MM-dd hh:mm:ss"):"暂无"))]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"lan",on:{click:function(a){e.rollback(t.row)}}},[e._v("回滚")])]}}])})],1)],1),e._v(" "),e.totalCount>e.pageSize?a("div",{staticClass:"basePagenate"},[a("el-pagination",{attrs:{"current-page":e.currentPage,"page-size":e.pageSize,layout:"total, prev, pager, next",total:e.totalCount},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.currentPage=t}}})],1):e._e(),e._v(" "),a("el-dialog",{attrs:{title:"回滚配置",visible:e.rollbackDialog,width:"700px"},on:{"update:visible":function(t){e.rollbackDialog=t},close:e.requestCompleted}},[a("div",{staticClass:"servicesubuscriber"},[a("el-table",{staticClass:"table",staticStyle:{width:"100%"},attrs:{data:e.rollbackConfList,stripe:""},on:{"selection-change":e.rbSelectChange}},[a("el-table-column",{attrs:{type:"selection",width:"60"}}),e._v(" "),a("el-table-column",{attrs:{label:"配置名称",prop:"name"}}),e._v(" "),a("el-table-column",{attrs:{label:"配置描述",prop:"desc"}}),e._v(" "),a("el-table-column",{attrs:{label:"配置版本",prop:"version"}}),e._v(" "),a("el-table-column",{attrs:{label:"创建时间",prop:"createTime"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer basebtn r",attrs:{slot:"footer"},slot:"footer"},[a("button",{attrs:{type:"button"},on:{click:function(t){e.rollbackDialog=!1}}},[e._v("取消")]),e._v(" "),a("button",{staticClass:"lan",attrs:{type:"button",disabled:e.isGetting},on:{click:e.rollbackGrayscaleConf}},[e.isGetting?a("i",{staticClass:"el-icon-loading"}):e._e(),e._v(e._s(e.isGettingText)+"\n      ")])])])],1)},o=[],l={render:r,staticRenderFns:o},c=l,d=a("VU/8"),u=i,p=d(n,c,!1,u,"data-v-324e5c0e",null);t.default=p.exports},"d+9i":function(e,t,a){var i=a("/7OG");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("rjj0")("062fea35",i,!0)}});
//# sourceMappingURL=22.3550bd9b76359069bf56.js.map