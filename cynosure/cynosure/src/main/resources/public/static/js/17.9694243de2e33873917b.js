webpackJsonp([17],{"3jLL":function(e,t,i){"use strict";function s(e){i("T2it")}Object.defineProperty(t,"__esModule",{value:!0});var n=i("Dd8w"),a=i.n(n),o=i("T452"),r=i("hCGe"),c=i("NYxO"),l={data:function(){return{fileConf:[],isAddConfig:!1,isAddVersion:!1,project:"",cluster:"",service:"",api:{list:!1},current:{service:!1,cluster:!1,version:!1,project:!1,file:!1,target:!1},inputNum:500,newServiceName:"",desc:"",newCLuster:[],curDesc:"",currentPage:1,totalCount:0,pageSize:10,dialog:{newConfig:!1,pushConfig:!1,editService:!1,detailService:!1,serviceVersion:!1},tableData:[],multipleSelection:[],curEditRow:{},curDetailRow:{},condition:{},options:[],oldSelectedOptions:[],selectedOptions:[],defaultProps:{label:"name",value:"name"},props:{label:"name",value:"name",children:"children"},projectName:"",clusterName:"",serviceName:"",version:"",versionId:"",clusterOptions:[],serviceOptions:[],versionOptions:[],regions:[],seledPushConfig:[],curPushRow:{},editPushRow:{},newPushConfigs:[],rollBackPushConfigs:[],newRegion:"",newPushUrl:"",showHandle:!1,progress:0,end:0,serviceSubscriberDialog:!1,regionList:[],serviceSubscriber:[],ssCurrentPage:1,ssPageSize:10,ssTotalCount:0,selectRegion:"",isGetting:!1,isGettingText:"确认"}},methods:a()({cancleEdit:function(e,t){this.regions.splice(e,1),this.showHandle=!1},handleEdit:function(e,t){var i=this;if(!this._checkRegion(t))return!1;if(!this._checkPushUrl(t))return!1;var s={};s.name=this.newRegion,s.pushUrl=this.newPushUrl,Object(r.e)(s).then(function(e){0===e.code?(i.boot("pushConfig"),i.showHandle=!1,i.newPushUrl="",i.newRegion="",i.$message({message:"新增成功",type:"success"})):i.$message({message:e.message,type:"error"})})},handleCurrentChange:function(e){this.currentPage=e,this.queryLatestConfigList()},closeErr:function(e){this.current[e]=!1},closeErrInRow:function(e,t){e[t]=!1},_checkName:function(){return""!==this.newServiceName||(this.current.name=!0,!1)},_checkProject:function(){return 0!==this.newCLuster.length||(this.current.cluster=!0,!1)},_checkVersion:function(){return""===this.version?(this.current.version=!0,!1):(this.current.version=!1,!0)},_checkRegion:function(e){return""!==this.newRegion||(e.checkedRegion=!0,!1)},_checkPushUrl:function(e){return""!==this.newPushUrl||(e.checkedPushUrl=!0,!1)},handleChange:function(){var e=this.selectedOptions[0]?this.selectedOptions[0]:"",t=this.selectedOptions[1]?this.selectedOptions[1]:"",i=this.selectedOptions[2]?this.selectedOptions[2]:"",s=this.selectedOptions[3]?this.selectedOptions[3]:"";1===this.selectedOptions.length&&(this.$message({message:"请为该项目创建集群",type:"warning"}),this.selectedOptions=this.oldSelectedOptions.slice(0)),2===this.selectedOptions.length&&(this.$message({message:"请为该集群创建服务",type:"warning"}),this.selectedOptions=this.oldSelectedOptions.slice(0)),3===this.selectedOptions.length&&(this.$message({message:"请为该服务创建版本",type:"warning"}),this.selectedOptions=this.oldSelectedOptions.slice(0)),e&&t&&i&&s&&this.queryLatestConfigList(e,t,i,s)},handleProjectChange:function(e){var t=this;this.current.project=!1,this.clusterOptions=[],this.clusterName="",this.serviceOptions=[],this.serviceName="",this.versionOptions=[],this.version="",this.options&&this.options.length>0&&this.options.map(function(i){i.name===e&&i.children&&(t.clusterOptions=i.children)})},handleClusterChange:function(e){var t=this;this.current.cluster=!1,this.serviceOptions=[],this.serviceName="",this.versionOptions=[],this.version="",this.clusterOptions&&this.clusterOptions.length>0&&this.clusterOptions.map(function(i){i.name===e&&i.children&&(t.serviceOptions=i.children)})},handleServiceChange:function(e){var t=this;this.current.service=!1,this.versionOptions=[],this.version="",this.serviceOptions&&this.serviceOptions.length>0&&this.serviceOptions.map(function(i){i.name===e&&i.children&&(t.versionOptions=i.children)})},handleVersionChange:function(){this.current.version=!1},initSelectedOptions:function(e){var t=this;this.api.list=!0,Object(r.R)().then(function(i){if(0===i.code){if(t.api.list=!1,i.data.list&&i.data.list.length>0){var s=[];i.data.list.map(function(e){var t={};if(t.name=e.name,t.id=e.id,e.children){var i=[];e.children.map(function(e){var t={};if(t.name=e.name,t.id=e.id,e.children){var s=[];e.children.map(function(e){var t={};if(t.name=e.name,t.id=e.id,e.children){var i=[];e.children.map(function(e){var t={};t.name=e.name,t.id=e.id,i.push(t)}),t.children=i}s.push(t)}),t.children=s}i.push(t)}),t.children=i}s.push(t)}),t.options=s,t.optionsCluster=s}t.queryLatestConfigList(),e&&(t.selectedOptions=e,t.handleChange())}else t.$message({message:i.message,type:"error"})})},queryLatestConfigList:function(e,t,i,s){var n=this,a={currentPage:this.currentPage,pagesize:this.pageSize};e&&t&&i&&s&&(a.project=e,a.cluster=t,a.service=i,a.version=s),Object(o.r)(a).then(function(e){if(0===e.code){if(n.tableData=e.data.list?e.data.list:[],e.data.condition){var t=JSON.parse(e.data.condition);n.condition=t;var i=n.options.filter(function(e){return e.name===t.project});if(i[0]&&i[0].children&&i[0].children.length>0){var s=i[0].children.filter(function(e){return e.name===t.cluster});if(s[0]&&s[0].children&&s[0].children.length>0){var a=s[0].children.filter(function(e){return e.name===t.service});a[0]&&a[0].children&&a[0].children.length>0?a[0].children.map(function(e){e.name===t.version&&(n.versionId=e.id,n.oldSelectedOptions=[],n.oldSelectedOptions.push(t.project,t.cluster,t.service,t.version),n.selectedOptions=n.oldSelectedOptions.slice(0))}):n.selectedOptions=[]}else n.selectedOptions=[]}else n.selectedOptions=[]}n.totalCount=e.data.totalCount,n.currentPage=e.data.currentPage}else n.$message({message:e.message,type:"error"})})},queryClusterList:function(){var e=this,t={};t.currentPage=this.currentPage,t.pagesize=this.pageSize,Object(r.H)(t).then(function(t){if(0===t.code)return t.data.list;e.$message({message:t.message,type:"error"})})},uploadFileChange:function(e,t){e.size?e.size>1048576?(t.splice(t.length-1,1),this.$message({message:e.name+"大小已超出1M，请重新选择",type:"error"})):/[\u4e00-\u9fa5]/.test(e.name)?(t.splice(t.length-1,1),this.$message({message:"请勿上传中文文件名的配置文件",type:"error"})):t.filter(function(t){return t.name===e.name}).length>1&&(t.splice(t.length-1,1),this.$message({message:"请勿上传文件名相同的配置文件",type:"error"})):(t.splice(t.length-1,1),this.$message({message:e.name+"为空文件，请重新选择",type:"error"})),this.current.file=!1},uploadFileNum:function(e,t){this.$message({message:"最多支持上传10个文件，当前选择了"+e.length+"个文件，共选择了"+(e.length+t.length)+"个文件",type:"error"})},addConfig:function(){var e=this;if(!this.projectName)return this.current.project=!0,!1;if(!this.clusterName)return this.current.cluster=!0,!1;if(!this.serviceName)return this.current.service=!0,!1;if(!this.version)return this.current.version=!0,!1;if(!(this.$refs.upload.uploadFiles.length>0))return this.current.file=!0,!1;var t=new FormData;t.append("project",this.projectName),t.append("cluster",this.clusterName),t.append("service",this.serviceName),t.append("version",this.version),t.append("desc",this.desc),this.$refs.upload.uploadFiles.forEach(function(e){t.append("file",e.raw)}),this.requestIn(),Object(r.Q)(t,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){0!==t.code?(e.requestCompleted(),e.$message({message:t.message,type:"error"})):(e.dialog.newConfig=!1,e.newPushConfigs=t.data.configs,e.initSelectedOptions(),e.pushConfigDialog(),e.boot("pushConfig"))}),this.isAddConfig=!0,this.selectedOptions=[],this.selectedOptions.push(this.projectName,this.clusterName,this.serviceName,this.version),this.handleChange()},addRegion:function(){if(!this.showHandle){var e={name:"",pushUrl:"",isNew:!0,checkedRegion:!1,checkedPushUrl:!1};this.showHandle=!0,this.regions.push(e)}},pushConfig:function(){var e=this,t={},i=[],s=void 0;if(!(this.seledPushConfig.length>0))return this.$message({message:"请选择推送区域",type:"error"}),!1;if(this.seledPushConfig.map(function(e){i.push(e.id),t.regionIds=i}),this.isAddConfig=!1,this.isAddVersion=!1,this.curPushRow&&this.curPushRow.id)t.id=this.curPushRow.id,s=o.t;else if(this.editPushRow&&this.editPushRow.id)t.id=this.editPushRow.id,s=o.t;else{s=o.u;var n=[];this.newPushConfigs.length>0?this.newPushConfigs.map(function(e){n.push(e.id)}):this.rollBackPushConfigs.length>0?this.rollBackPushConfigs.map(function(e){n.push(e.configId)}):this.multipleSelection.map(function(e){n.push(e.id)}),t.ids=n}this.newPushConfigs.length=0,this.curPushRow={},this.requestIn(),s(t).then(function(t){0===t.code?(e.$message({message:"推送成功！",type:"success"}),e.handleChange()):e.$message({message:t.message,type:"error"}),e.$refs.pushConfig.clearSelection(),e.$refs.config.clearSelection(),e.dialogRest("pushConfig"),e.requestCompleted()})},downloadConf:function(e){Object(o.i)("?id="+e.id).then(function(e){var t=document,i=t.createElement("a");i.download=e.data.fileName,i.style.display="none";var s=new Blob([e.data.content]);i.href=URL.createObjectURL(s),t.body.appendChild(i),i.click(),t.body.removeChild(i)})},addService:function(){var e=this;if(!this._checkName())return!1;if(!this._checkProject())return!1;var t={};t.name=this.newServiceName,t.desc=this.desc,t.clusterId=this.newCLuster[1],Object(r.f)(t).then(function(t){0===t.code?(e.dialogRest("newConfig"),e.$message({message:"新建成功！",type:"success"}),e.queryLatestConfigList()):e.$message({message:t.message,type:"error"})})},openServiceVersionDialog:function(){var e=[];this.tableData.forEach(function(t){e.push(t.id)}),this.fileConf=e,this.projectName=this.condition.project,this.clusterName=this.condition.cluster,this.serviceName=this.condition.service,this.boot("serviceVersion")},inputNumChange:function(e){var t=this,i=setTimeout(function(s){t.inputNum=500-t.$refs[e].value.length,clearTimeout(i)},300)},newServiceVersion:function(){this.current.version=!1,this.dialog.serviceVersion=!0,this.version="",this.desc="",this.fileConf=[]},addServiceVer:function(){var e=this;if(!this._checkVersion())return!1;var t=new FormData;t.append("project",this.projectName),t.append("cluster",this.clusterName),t.append("service",this.serviceName),t.append("version",this.version),t.append("desc",this.desc),t.append("ids",this.fileConf),this.$refs.uploadSV.uploadFiles.forEach(function(e){t.append("file",e.raw)}),this.requestIn(),Object(o.c)(t,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){if(0===t.code){e.dialog.serviceVersion=!1,t.data.configs.length>0&&e.boot("pushConfig");var i=e.selectedOptions;i.pop(),i.push(e.version),e.initSelectedOptions(i),e.$message({message:t.message,type:"success"}),e.pushConfigDialog(),e.newPushConfigs=t.data.configs}else e.requestCompleted(),e.$message({message:t.message,type:"error"})})},closeServiceVer:function(){this.desc="",this.inputNum=500,this.$refs.uploadSV.clearFiles(),this.dialog.serviceVersion=!1,this.requestCompleted()},handleSelectionChange:function(e){this.multipleSelection=e},handleSelPushConfigChange:function(e){this.seledPushConfig=e,this.current.target=!1},openNewConfigDialog:function(){var e=this;this.projectName=this.selectedOptions[0],this.clusterName=this.selectedOptions[1],this.serviceName=this.selectedOptions[2],this.version=this.selectedOptions[3],this.boot("newConfig"),this.options&&this.options.length>0&&this.options.map(function(t){t.name===e.projectName&&t.children&&(e.clusterOptions=t.children)}),this.clusterOptions&&this.clusterOptions.length>0&&this.clusterOptions.map(function(t){t.name===e.clusterName&&t.children&&(e.serviceOptions=t.children)}),this.serviceOptions&&this.serviceOptions.length>0&&this.serviceOptions.map(function(t){t.name===e.serviceName&&t.children&&(e.versionOptions=t.children)})},closeNewConfigDialog:function(){this.dialogRest("newConfig"),this.projectName="",this.clusterName="",this.serviceName="",this.version="",this.inputNum=500,this.$refs.upload.clearFiles(),this.requestCompleted()},boot:function(e){var t=this;this.dialog[e]=!0,"pushConfig"===e&&Object(r.O)({isPage:0}).then(function(e){0===e.code?e.data.list&&e.data.list.length>0&&(t.regions=e.data.list):t.$message({message:e.message,type:"error"})})},dialogRest:function(e){this.editPushConfig({}),this.setRollBack([]),this.dialog[e]=!1,this.newServiceName="",this.newCLuster=[],this.desc="",this.current.name=!1,this.current.cluster=!1,this.current.service=!1,this.current.version=!1,this.current.project=!1,this.current.file=!1,this.current.target=!1,this.showHandle=!1,this.newPushUrl="",this.newRegion="",this.inputNum=500,this.isAddConfig&&(this.queryLatestConfigList(),this.isAddConfig=!1),this.isAddVersion&&(this.queryLatestConfigList(),this.isAddVersion=!1)},detailsConfig:function(e){this.$router.push("/main/config/edit/?id="+e.id+"&project="+this.condition.project+"&cluster="+this.condition.cluster+"&service="+this.condition.service+"&version="+this.condition.version+"&name="+e.name+"&edit=0")},editConfig:function(e){this.curEditRow=e,this.$router.push("/main/config/edit/?id="+e.id+"&project="+this.condition.project+"&cluster="+this.condition.cluster+"&service="+this.condition.service+"&version="+this.condition.version+"&name="+e.name)},historyVersion:function(){this.$router.push("/main/config/history_version/?project="+this.condition.project+"&cluster="+this.condition.cluster+"&service="+this.condition.service+"&version="+this.condition.version)},pushConfigDialog:function(e){(e||this.multipleSelection.length>0)&&(this.curPushRow=e,this.boot("pushConfig"))},editService:function(){var e=this,t={};t.id=this.curEditRow.id,t.desc=this.curDesc,this.requestIn(),Object(r.E)(t).then(function(t){0===t.code?(e.dialogRest("editService"),e.$message({message:"编辑成功！",type:"success"}),e.queryLatestConfigList()):(e.requestCompleted(),e.$message({message:t.message,type:"error"}))})},detailServiceDialog:function(e){var t=this;this.boot("detailService"),Object(r.x)(e.id).then(function(e){0===e.code?t.curDetailRow=e.data:t.$message({message:e.message,type:"error"})})},_deleteConfig:function(e){var t=this,i=null;i=e?o.h:o.d;var s={};if(e)s.id=e.id;else{var n=[];this.multipleSelection.map(function(e){n.push(e.id)}),s.ids=n}this.$confirm("此操作将删除选中配置, 是否继续?","提示",{confirmButtonText:"确 定",cancelButtonText:"取 消",type:"warning"}).then(function(){i(s).then(function(e){0===e.code?(t.$message({message:"删除成功！",type:"success"}),t.queryLatestConfigList()):t.$message({message:e.message,type:"error"})})})},getRegionList:function(){var e=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object(r.O)({isPage:0}).then(function(t){0!==t.code?e.$message({message:t.message?t.message:"获取推送区域列表失败",type:"type"}):t.data.list&&(e.regionList=t.data.list)})},getConfConsumer:function(){var e=this;this.projectName=this.selectedOptions[0],this.clusterName=this.selectedOptions[1],this.serviceName=this.selectedOptions[2],this.version=this.selectedOptions[3],Object(o.k)("?project="+this.projectName+"&cluster="+this.clusterName+"&service="+this.serviceName+"&version="+this.version+"&region="+this.selectRegion+"&grayId=0&isPage=1&currentPage="+this.ssCurrentPage+"&pagesize="+this.ssPageSize).then(function(t){0!==t.code?e.$message({message:t.message?t.message:"获取订阅者列表失败",type:"error"}):t.data&&(e.serviceSubscriber=t.data.list,e.serviceSubscriber.map(function(e,t){e.index=t+1}),e.ssTotalCount=t.data.totalCount)})},ssCurrentChange:function(){this.getConfConsumer()},closeserviceSubscriber:function(){this.selectRegion="",this.serviceSubscriber=[],this.ssTotalCount=0,this.ssCurrentChange=1},requestIn:function(){this.isGetting=!0,this.isGettingText="处理中"},requestCompleted:function(){this.isGetting=!1,this.isGettingText="确认"}},Object(c.c)({editPushConfig:"SET_SAVEEDITCONFIG",setRollBack:"SET_CONFIRMROLLBACK"})),created:function(){this.init=!0,this.initSelectedOptions(),this.editPushRow=this.saveEditConfig,this.editPushRow.id&&this.boot("pushConfig"),this.rollBackPushConfigs=this.confirmRollBack,this.confirmRollBack&&this.confirmRollBack.length>0&&this.boot("pushConfig")},computed:a()({},Object(c.b)(["userInfo","confirmRollBack","saveEditConfig"]),{userInfoData:function(){return JSON.parse(this.userInfo)}})},u=function(){var e=this,t=this,i=t.$createElement,s=t._self._c||i;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.api.list,expression:"api.list"}],staticClass:"configCenter",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[s("div",{staticClass:"deal clearfix"},[s("div",{staticClass:"basebtn l"},[s("button",{staticClass:"lan",on:{click:function(e){t.boot("newConfig")}}},[t._v("新增配置")]),t._v(" "),s("button",{class:[{disable:!this.tableData},{active:this.tableData}],attrs:{disabled:!this.tableData},on:{click:function(e){t.newServiceVersion()}}},[t._v("快速新增版本")]),t._v(" "),s("button",{class:[{disable:!this.tableData},{active:this.tableData}],attrs:{disabled:!this.tableData},on:{click:function(e){t.historyVersion()}}},[t._v("历史配置")]),t._v(" "),s("button",{class:[{disable:!this.selectedOptions},{active:this.selectedOptions}],attrs:{disabled:!this.selectedOptions},on:{click:function(e){t.serviceSubscriberDialog=!0}}},[t._v("查看订阅者")]),t._v(" "),s("router-link",{class:[{disable:!this.selectedOptions},{active:this.selectedOptions}],attrs:{to:"/main/config/grayscale_group?project="+this.selectedOptions[0]+"&cluster="+this.selectedOptions[1]+"&service="+this.selectedOptions[2]+"&version="+this.selectedOptions[3]+"&versionId="+this.versionId,tag:"button",disabled:!this.selectedOptions}},[t._v("灰度发布")]),t._v(" "),s("button",{class:[{disable:!t.multipleSelection.length},{active:t.multipleSelection.length}],attrs:{disabled:!t.multipleSelection.length},on:{click:function(e){t.pushConfigDialog()}}},[t._v("批量推送")]),t._v(" "),s("button",{class:[{disable:!t.multipleSelection.length},{active:t.multipleSelection.length}],attrs:{disabled:!t.multipleSelection.length},on:{click:function(e){t._deleteConfig()}}},[t._v("批量删除")])],1),t._v(" "),s("div",{staticClass:"search-box r",attrs:{id:"step2"}},[s("el-cascader",{ref:"cascader",staticClass:"cascader",attrs:{placeholder:"请输入关键字",filterable:"",options:t.options,props:t.props,cascaderTitle:["项目","集群","服务","服务版本"]},on:{change:t.handleChange},model:{value:t.selectedOptions,callback:function(e){t.selectedOptions=e},expression:"selectedOptions"}})],1)]),t._v(" "),s("div",{staticClass:"table"},[s("el-table",{ref:"config",staticClass:"no-border",staticStyle:{width:"100%"},attrs:{data:t.tableData},on:{"selection-change":t.handleSelectionChange}},[s("el-table-column",{attrs:{type:"selection",width:"54"}}),t._v(" "),s("el-table-column",{attrs:{label:"配置名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{staticClass:"lan",on:{click:function(i){t.detailsConfig(e.row)}}},[t._v(t._s(e.row.name))])]}}])}),t._v(" "),s("el-table-column",{attrs:{prop:"path",label:"配置路径"}}),t._v(" "),s("el-table-column",{attrs:{prop:"desc",label:"配置描述"}}),t._v(" "),s("el-table-column",{attrs:{label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(new Date(e.row.createTime).Format("yyyy-MM-dd hh:mm:ss")))]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"更新时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.updateTime?new Date(e.row.updateTime).Format("yyyy-MM-dd hh:mm:ss"):"-"))]}}])}),t._v(" "),s("el-table-column",{attrs:{prop:"uid",label:"操作",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{staticClass:"lan",on:{click:function(i){t.editConfig(e.row)}}},[t._v("编辑")]),t._v(" "),s("span",{staticClass:"lan",on:{click:function(i){t.pushConfigDialog(e.row)}}},[t._v("推送")]),t._v(" "),s("span",{staticClass:"lan",on:{click:function(i){t.downloadConf(e.row)}}},[t._v("下载")]),t._v(" "),s("span",{staticClass:"lan",on:{click:function(i){t._deleteConfig(e.row)}}},[t._v("删除")])]}}])}),t._v(" "),s("div",{attrs:{slot:"empty"},slot:"empty"},[0==this.selectedOptions.length?s("div",[s("a",{staticClass:"lan",on:{click:function(e){t.boot("newConfig")}}},[t._v("新增配置")]),t._v(" "),s("span",[s("span",[t._v("或")]),t._v(" "),s("a",{staticClass:"lan",on:{click:function(){e.$refs.cascader.handleClick()}}},[t._v("输入关键字筛选查看内容")])])]):s("p",[t._v("暂无数据")])])],1)],1),t._v(" "),t.totalCount>t.pageSize?s("div",{staticClass:"basePagenate"},[s("el-pagination",{attrs:{"page-size":t.pageSize,"current-page":t.currentPage,total:t.totalCount,layout:"prev, pager, next"},on:{"current-change":t.handleCurrentChange}})],1):t._e(),t._v(" "),s("el-dialog",{attrs:{title:"新增配置",visible:t.dialog.newConfig,width:"600px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.$set(t.dialog,"newConfig",e)},open:t.openNewConfigDialog,close:t.closeNewConfigDialog}},[s("div",{staticClass:"dialog"},[s("ul",{staticClass:"createuser"},[s("li",[s("span",[s("i",{staticClass:"validate-input"},[t._v("项目名称")])]),t._v(" "),s("div",[s("el-select",{attrs:{disabled:"",placeholder:"请选择项目名称"},on:{change:t.handleProjectChange},model:{value:t.projectName,callback:function(e){t.projectName=e},expression:"projectName"}},t._l(t.options,function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.name,props:t.defaultProps}})})),t._v(" "),s("transition",{attrs:{name:"slide"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.current.project,expression:"current.project"}],staticClass:"tips",class:{err:t.current.project}},[t._v("\n                项目不能为空\n              ")])])],1)]),t._v(" "),s("li",[s("span",[s("i",{staticClass:"validate-input"},[t._v("集群名称")])]),t._v(" "),s("div",[s("el-select",{attrs:{disabled:"",placeholder:"请选择集群名称"},on:{change:t.handleClusterChange},model:{value:t.clusterName,callback:function(e){t.clusterName=e},expression:"clusterName"}},t._l(t.clusterOptions,function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.name}})})),t._v(" "),s("transition",{attrs:{name:"slide"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.current.cluster,expression:"current.cluster"}],staticClass:"tips",class:{err:t.current.cluster}},[t._v("\n                集群不能为空\n              ")])])],1)]),t._v(" "),s("li",[s("span",[s("i",{staticClass:"validate-input"},[t._v("服务名称")])]),t._v(" "),s("div",[s("el-select",{attrs:{disabled:"",placeholder:"请选择服务名称"},on:{change:t.handleServiceChange},model:{value:t.serviceName,callback:function(e){t.serviceName=e},expression:"serviceName"}},t._l(t.serviceOptions,function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.name}})})),t._v(" "),s("transition",{attrs:{name:"slide"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.current.service,expression:"current.service"}],staticClass:"tips",class:{err:t.current.service}},[t._v("\n                服务不能为空\n              ")])])],1)]),t._v(" "),s("li",[s("span",[s("i",{staticClass:"validate-input"},[t._v("服务版本")])]),t._v(" "),s("div",[s("el-select",{attrs:{disabled:"",placeholder:"请选择服务版本"},on:{change:t.handleVersionChange},model:{value:t.version,callback:function(e){t.version=e},expression:"version"}},t._l(t.versionOptions,function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.name}})})),t._v(" "),s("transition",{attrs:{name:"slide"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.current.version,expression:"current.version"}],staticClass:"tips",class:{err:t.current.version}},[t._v("\n                服务版本不能为空\n              ")])])],1)]),t._v(" "),s("li",[s("span",[t._v("配置描述")]),t._v(" "),s("div",{staticClass:"basetxt"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.desc,expression:"desc"}],ref:"addConf",staticClass:"desc",attrs:{maxlength:"500"},domProps:{value:t.desc},on:{input:[function(e){e.target.composing||(t.desc=e.target.value)},function(e){t.inputNumChange("addConf")}]}}),t._v(" "),s("p",{staticClass:"l"},[t._v("你还可以输入"+t._s(t.inputNum)+"个字符")])])]),t._v(" "),s("li",[s("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{multiple:"",drag:"","auto-upload":!1,"on-change":t.uploadFileChange,limit:10,"on-exceed":t.uploadFileNum,action:"/api/api/v1/quickStart/addServiceConfig"}},[s("i",{staticClass:"el-icon-upload"}),t._v(" "),s("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),s("em",[t._v("点击上传")])]),t._v(" "),s("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("支持多文件上传，单个文件大小最大为1M，最大支持10个文件。")])]),t._v(" "),s("transition",{attrs:{name:"slide"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.current.file,expression:"current.file"}],staticClass:"tips",class:{err:t.current.file}},[t._v("\n              请上传文件！\n            ")])])],1)])]),t._v(" "),s("span",{staticClass:"dialog-footer basebtn",attrs:{slot:"footer"},slot:"footer"},[s("div",{staticClass:"clearfix my-footer"},[s("button",{staticClass:"active",attrs:{type:"button"},on:{click:function(e){t.dialogRest("newConfig")}}},[t._v("取消")]),t._v(" "),s("button",{staticClass:"lan",attrs:{type:"button",disabled:t.isGetting},on:{click:function(e){t.addConfig()}}},[t.isGetting?s("i",{staticClass:"el-icon-loading"}):t._e(),t._v(t._s(t.isGettingText)+"\n        ")])])])]),t._v(" "),s("el-dialog",{attrs:{title:"快速新增版本",visible:t.dialog.serviceVersion,pos:"center",width:"600px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.$set(t.dialog,"serviceVersion",e)},open:t.openServiceVersionDialog,close:t.closeServiceVer}},[s("div",{staticClass:"dialog"},[s("ul",{staticClass:"createuser"},[s("li",[s("span",[t._v("项目名称")]),t._v(" "),s("output",[t._v(t._s(t.condition.project))])]),t._v(" "),s("li",[s("span",[t._v("集群名称")]),t._v(" "),s("output",[t._v(t._s(t.condition.cluster))])]),t._v(" "),s("li",[s("span",[t._v("服务名称")]),t._v(" "),s("output",[t._v(t._s(t.condition.service))])]),t._v(" "),s("li",[s("span",[s("i",{staticClass:"validate-input"},[t._v("版本名称")])]),t._v(" "),s("div",{staticClass:"basetxt"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.version,expression:"version"}],attrs:{placeholder:"请输入版本名称"},domProps:{value:t.version},on:{blur:t._checkVersion,input:function(e){e.target.composing||(t.version=e.target.value)}}}),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.current.version,expression:"current.version"}],staticClass:"tips",class:{err:t.current.version}},[t._v("\n              版本名称不能为空\n            ")])])]),t._v(" "),s("li",[s("span",[t._v("版本描述")]),t._v(" "),s("div",{staticClass:"basetxt"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.desc,expression:"desc"}],ref:"addVersion",staticClass:"desc",attrs:{maxlength:"500"},domProps:{value:t.desc},on:{input:[function(e){e.target.composing||(t.desc=e.target.value)},function(e){t.inputNumChange("addVersion")}]}}),t._v(" "),s("p",{staticClass:"l"},[t._v("你还可以输入"+t._s(t.inputNum)+"个字符")])])]),t._v(" "),s("li",[s("span",[t._v("配置文件")]),t._v(" "),s("div",[s("span",[t._v("请选择需同步的当前版本的配置文件：")]),s("br"),t._v(" "),s("el-select",{staticClass:"fileconf",attrs:{multiple:""},model:{value:t.fileConf,callback:function(e){t.fileConf=e},expression:"fileConf"}},t._l(t.tableData,function(e,t){return s("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),s("br"),t._v(" "),s("span",[t._v("添加其他配置文件：")])],1)]),t._v(" "),s("li",[s("el-upload",{ref:"uploadSV",staticClass:"upload-demo",attrs:{multiple:"",drag:"","auto-upload":!1,"on-change":t.uploadFileChange,limit:10,"on-exceed":t.uploadFileNum,action:"/api/api/v1/quickStart/addServiceVersion"}},[s("i",{staticClass:"el-icon-upload"}),t._v(" "),s("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),s("em",[t._v("点击上传")])]),t._v(" "),s("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("支持多文件上传，单个文件大小最大为1M，最大支持10个文件")])])],1)])]),t._v(" "),s("span",{staticClass:"dialog-footer basebtn",attrs:{slot:"footer"},slot:"footer"},[s("div",{staticClass:"clearfix my-footer"},[s("button",{staticClass:"active",attrs:{type:"button"},on:{click:function(e){t.dialog.serviceVersion=!1}}},[t._v("取消")]),t._v(" "),s("button",{staticClass:"lan",attrs:{type:"button",disabled:t.isGetting},on:{click:function(e){t.addServiceVer()}}},[t.isGetting?s("i",{staticClass:"el-icon-loading"}):t._e(),t._v(t._s(t.isGettingText)+"\n        ")])])])]),t._v(" "),s("el-dialog",{attrs:{title:"推送配置",visible:t.dialog.pushConfig,width:"600px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.$set(t.dialog,"pushConfig",e)},close:function(e){t.dialogRest("pushConfig"),t.requestCompleted()}}},[s("div",{staticClass:"dialog"},[s("p",{},[t._v("选择推送的目标区域"),1===t.userInfoData.roleType?s("i",{staticClass:"el-icon-circle-plus circle-plus",on:{click:t.addRegion}}):t._e()]),t._v(" "),s("el-table",{ref:"pushConfig",staticStyle:{width:"100%"},attrs:{data:t.regions},on:{"selection-change":t.handleSelPushConfigChange}},[s("el-table-column",{attrs:{type:"selection"}}),t._v(" "),s("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"name",label:"区域"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",[e.row.isNew?s("el-input",{class:{checkedRegion:e.row.checkedRegion},attrs:{type:"text"},on:{blur:function(i){t._checkRegion(e.row)},focus:function(i){t.closeErrInRow(e.row,"checkedRegion")}},model:{value:t.newRegion,callback:function(e){t.newRegion=e},expression:"newRegion"}}):s("p",[t._v(t._s(e.row.name))])],1)]}}])}),t._v(" "),s("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"pushUrl",label:"companion"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",[e.row.isNew?s("el-input",{class:{checkedRegion:e.row.checkedPushUrl},attrs:{type:"text"},on:{blur:function(i){t._checkPushUrl(e.row)},focus:function(i){t.closeErrInRow(e.row,"checkedPushUrl")}},model:{value:t.newPushUrl,callback:function(e){t.newPushUrl=e},expression:"newPushUrl"}}):s("p",[t._v(t._s(e.row.pushUrl))])],1)]}}])}),t._v(" "),t.showHandle?s("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isNew?s("el-button",{staticClass:"lan",attrs:{size:"mini"},on:{click:function(i){t.handleEdit(e.$index,e.row)}}},[t._v("保存")]):t._e(),t._v(" "),e.row.isNew?s("el-button",{staticClass:"lan",attrs:{size:"mini"},on:{click:function(i){t.cancleEdit(e.$index,e.row)}}},[t._v("取消")]):t._e()]}}])}):t._e()],1),t._v(" "),s("ul",{staticClass:"createuser"},[s("li",[s("transition",{attrs:{name:"slide"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.current.target,expression:"current.target"}],staticClass:"tips",class:{err:t.current.target}},[t._v("\n              请选择推送的目标区域！\n            ")])])],1)])],1),t._v(" "),s("span",{staticClass:"dialog-footer basebtn",attrs:{slot:"footer"},slot:"footer"},[s("div",{staticClass:"clearfix my-footer"},[s("button",{attrs:{type:"button"},on:{click:function(e){t.dialog.pushConfig=!1}}},[t._v("取消")]),t._v(" "),s("button",{staticClass:"lan",attrs:{type:"button",disabled:t.isGetting},on:{click:function(e){t.pushConfig()}}},[t.isGetting?s("i",{staticClass:"el-icon-loading"}):t._e(),t._v(t._s(t.isGettingText)+"\n        ")])])])]),t._v(" "),s("el-dialog",{attrs:{title:"编辑服务",visible:t.dialog.editService,width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.$set(t.dialog,"editService",e)},close:function(e){t.dialogRest("editService"),t.requestCompleted()}}},[s("div",{staticClass:"dialog"},[s("ul",{staticClass:"createuser"},[s("li",[s("span",[t._v("服务名称:")]),t._v(" "),s("div",{staticClass:"basetxt"},[s("span",[t._v(t._s(t.curEditRow.name))])])]),t._v(" "),s("li",[s("span",[t._v("服务描述:")]),t._v(" "),s("div",{staticClass:"basetxt"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.curDesc,expression:"curDesc"}],ref:"editService",staticClass:"desc",attrs:{maxlength:"500"},domProps:{value:t.curDesc},on:{input:[function(e){e.target.composing||(t.curDesc=e.target.value)},function(e){t.inputNumChange("editService")}]}}),t._v(" "),s("p",{staticClass:"l"},[t._v("你还可以输入"+t._s(t.inputNum)+"个字符")])])])])]),t._v(" "),s("span",{staticClass:"dialog-footer basebtn",attrs:{slot:"footer"},slot:"footer"},[s("div",{staticClass:"clearfix my-footer"},[s("button",{attrs:{type:"button"},on:{click:function(e){t.dialog.editService=!1}}},[t._v("取消")]),t._v(" "),s("button",{staticClass:"lan",attrs:{type:"button",disabled:t.isGetting},on:{click:function(e){t.editService()}}},[t.isGetting?s("i",{staticClass:"el-icon-loading"}):t._e(),t._v(t._s(t.isGettingText)+"\n        ")])])])]),t._v(" "),s("el-dialog",{attrs:{title:"服务详情",visible:t.dialog.detailService,width:"500px"},on:{"update:visible":function(e){t.$set(t.dialog,"detailService",e)},close:function(e){t.dialogRest("detailService")}}},[s("div",{staticClass:"dialog"},[s("ul",{staticClass:"createuser"},[s("li",[s("span",[t._v("服务名称:")]),t._v(" "),s("div",{staticClass:"basetxt"},[s("span",[t._v(t._s(t.curDetailRow.name))])])]),t._v(" "),s("li",[s("span",[t._v("服务描述:")]),t._v(" "),s("div",{staticClass:"basetxt"},[s("p",[t._v(t._s(t.curDetailRow.desc?t.curDetailRow.desc:"-"))])])]),t._v(" "),s("li",[s("span",[t._v("创建时间:")]),t._v(" "),s("div",{staticClass:"basetxt"},[s("span",{staticStyle:{width:"100%"}},[t._v(t._s(new Date(t.curDetailRow.createTime).Format("yyyy-MM-dd hh:mm:ss")))])])]),t._v(" "),s("li",[s("span",[t._v("更新时间:")]),t._v(" "),s("div",{staticClass:"basetxt"},[s("span",{staticStyle:{width:"100%"}},[t._v(t._s(t.curDetailRow.updateTime?new Date(t.curDetailRow.updateTime).Format("yyyy-MM-dd hh:mm:ss"):"-"))])])])])]),t._v(" "),s("span",{staticClass:"dialog-footer basebtn",attrs:{slot:"footer"},slot:"footer"},[s("div",{staticClass:"clearfix my-footer"},[s("button",{staticClass:"lan",attrs:{type:"button"},on:{click:function(e){t.dialog.detailService=!1}}},[t._v("确定")])])])]),t._v(" "),s("el-dialog",{attrs:{title:"查看服务订阅者",visible:t.serviceSubscriberDialog,width:"500px"},on:{"update:visible":function(e){t.serviceSubscriberDialog=e},open:function(e){t.getRegionList("region")},close:t.closeserviceSubscriber}},[s("div",{staticClass:"servicesubuscriber"},[s("div",{staticClass:"title"},[s("span",{staticClass:"l"},[t._v("区域：")]),t._v(" "),s("el-select",{staticClass:"l select",attrs:{placeholder:"请选择查看订阅者区域"},on:{change:t.getConfConsumer},model:{value:t.selectRegion,callback:function(e){t.selectRegion=e},expression:"selectRegion"}},t._l(t.regionList,function(e,i){return s("el-option",{key:i,attrs:{label:e.name,value:e.name}},[s("span",{staticClass:"l"},[t._v(t._s(e.name))]),t._v(" "),s("span",{staticClass:"r"},[t._v(t._s(e.pushUrl))])])}))],1),t._v(" "),s("el-table",{staticClass:"table",staticStyle:{width:"100%"},attrs:{data:t.serviceSubscriber,stripe:""}},[s("el-table-column",{attrs:{label:"编号",prop:"index"}}),t._v(" "),s("el-table-column",{attrs:{label:"地址",prop:"addr"}})],1),t._v(" "),t.ssTotalCount>t.ssPageSize?s("div",{staticClass:"basePagenate"},[s("el-pagination",{attrs:{"current-page":t.ssCurrentPage,"page-size":t.ssPageSize,layout:"total, prev, pager, next",total:t.ssTotalCount},on:{"current-change":t.ssCurrentChange,"update:currentPage":function(e){t.ssCurrentPage=e}}})],1):t._e()],1),t._v(" "),s("span",{staticClass:"dialog-footer basebtn r",attrs:{slot:"footer"},slot:"footer"},[s("button",{staticClass:"lan",attrs:{type:"button"},on:{click:function(e){t.serviceSubscriberDialog=!1}}},[t._v("关闭")])])])],1)},d=[],h={render:u,staticRenderFns:d},p=h,g=i("VU/8"),v=s,f=g(l,p,!1,v,null,null);t.default=f.exports},T2it:function(e,t,i){var s=i("qxZJ");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);i("rjj0")("8a83d54a",s,!0)},qxZJ:function(e,t,i){t=e.exports=i("FZ+f")(!0),t.push([e.i,'.configCenter{min-width:1100px;padding:20px}.configCenter .deal{margin-bottom:20px}.configCenter .deal .search-box .cascader{width:300px}.configCenter .el-table .lan{cursor:pointer}.configCenter .my-footer{display:inline-block}.configCenter .circle-plus{margin-left:10px;cursor:pointer}.configCenter .checkedRegion input{color:#e1504a;border-color:#e1504a}.configCenter .createuser li{margin-bottom:20px;color:#333}.configCenter .createuser li:last-of-type{margin:0}.configCenter .createuser li>span{width:90px;float:left}.configCenter .createuser li div{overflow:hidden}.configCenter .createuser li .validate-input:after{display:inline-block;content:"*";vertical-align:middle;color:#e1504a;margin-left:5px}.configCenter .createuser li output{display:block;height:30px}.configCenter .createuser li .fileconf{width:350px;margin:15px 0 10px}.configCenter .createuser textarea{width:350px;height:90px;resize:none;padding:10px 15px}.configCenter .createuser .err{border-color:red}.configCenter .createuser .tips{font-size:12px;line-height:18px;text-align:left;overflow:hidden;max-height:100px;text-indent:1px;padding-top:6px}.configCenter .createuser .tips.slide-enter-active,.configCenter .createuser .tips.slide-leave-active{-webkit-transition:max-height .9s;transition:max-height .9s}.configCenter .createuser .tips.slide-enter,.configCenter .createuser .tips.slide-leave-to{max-height:0}.configCenter .createuser .tips.err{color:#db4437}.configCenter .servicesubuscriber .title{height:30px;line-height:30px}.configCenter .servicesubuscriber .select{width:90%;margin-bottom:20px}.el-icon-loading{color:#000;margin-right:5px}',"",{version:3,sources:["D:/admin/config/src/components/config_center/config.vue"],names:[],mappings:"AACA,cACE,iBAAkB,AAClB,YAAc,CACf,AACD,oBACE,kBAAoB,CACrB,AACD,0CACE,WAAa,CACd,AACD,6BACE,cAAgB,CACjB,AACD,yBACE,oBAAsB,CACvB,AACD,2BACE,iBAAkB,AAClB,cAAgB,CACjB,AACD,mCACE,cAAe,AACf,oBAAsB,CACvB,AACD,6BACE,mBAAoB,AACpB,UAAY,CACb,AACD,0CACE,QAAU,CACX,AACD,kCACE,WAAY,AACZ,UAAY,CACb,AACD,iCACE,eAAiB,CAClB,AACD,mDACE,qBAAsB,AACtB,YAAa,AACb,sBAAuB,AACvB,cAAe,AACf,eAAiB,CAClB,AACD,oCACE,cAAe,AACf,WAAa,CACd,AACD,uCACE,YAAa,AACb,kBAAoB,CACrB,AACD,mCACE,YAAa,AACb,YAAa,AACb,YAAa,AACb,iBAAmB,CACpB,AACD,+BACE,gBAAmB,CACpB,AACD,gCACE,eAAgB,AAChB,iBAAkB,AAClB,gBAAiB,AACjB,gBAAiB,AACjB,iBAAkB,AAClB,gBAAiB,AACjB,eAAiB,CAClB,AACD,sGAEE,kCAAoC,AACpC,yBAA4B,CAC7B,AACD,2FAEE,YAAc,CACf,AACD,oCACE,aAAe,CAChB,AACD,yCACE,YAAa,AACb,gBAAkB,CACnB,AACD,0CACE,UAAW,AACX,kBAAoB,CACrB,AACD,iBACE,WAAY,AACZ,gBAAkB,CACnB",file:"config.vue",sourcesContent:["\n.configCenter {\n  min-width: 1100px;\n  padding: 20px;\n}\n.configCenter .deal {\n  margin-bottom: 20px;\n}\n.configCenter .deal .search-box .cascader {\n  width: 300px;\n}\n.configCenter .el-table .lan {\n  cursor: pointer;\n}\n.configCenter .my-footer {\n  display: inline-block;\n}\n.configCenter .circle-plus {\n  margin-left: 10px;\n  cursor: pointer;\n}\n.configCenter .checkedRegion input {\n  color: #e1504a;\n  border-color: #e1504a;\n}\n.configCenter .createuser li {\n  margin-bottom: 20px;\n  color: #333;\n}\n.configCenter .createuser li:last-of-type {\n  margin: 0;\n}\n.configCenter .createuser li >span {\n  width: 90px;\n  float: left;\n}\n.configCenter .createuser li div {\n  overflow: hidden;\n}\n.configCenter .createuser li .validate-input:after {\n  display: inline-block;\n  content: '*';\n  vertical-align: middle;\n  color: #e1504a;\n  margin-left: 5px;\n}\n.configCenter .createuser li output {\n  display: block;\n  height: 30px;\n}\n.configCenter .createuser li .fileconf {\n  width: 350px;\n  margin: 15px 0 10px;\n}\n.configCenter .createuser textarea {\n  width: 350px;\n  height: 90px;\n  resize: none;\n  padding: 10px 15px;\n}\n.configCenter .createuser .err {\n  border-color: #f00;\n}\n.configCenter .createuser .tips {\n  font-size: 12px;\n  line-height: 18px;\n  text-align: left;\n  overflow: hidden;\n  max-height: 100px;\n  text-indent: 1px;\n  padding-top: 6px;\n}\n.configCenter .createuser .tips.slide-enter-active,\n.configCenter .createuser .tips.slide-leave-active {\n  -webkit-transition: max-height 0.9s;\n  transition: max-height 0.9s;\n}\n.configCenter .createuser .tips.slide-enter,\n.configCenter .createuser .tips.slide-leave-to {\n  max-height: 0;\n}\n.configCenter .createuser .tips.err {\n  color: #db4437;\n}\n.configCenter .servicesubuscriber .title {\n  height: 30px;\n  line-height: 30px;\n}\n.configCenter .servicesubuscriber .select {\n  width: 90%;\n  margin-bottom: 20px;\n}\n.el-icon-loading {\n  color: #000;\n  margin-right: 5px;\n}"],sourceRoot:""}])}});
//# sourceMappingURL=17.9694243de2e33873917b.js.map