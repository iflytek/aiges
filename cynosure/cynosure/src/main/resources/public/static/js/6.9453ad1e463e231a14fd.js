webpackJsonp([6],{"2KBT":function(e,t,a){t=e.exports=a("FZ+f")(!0),t.push([e.i,".grayscale-group[data-v-fe10ed0a]{min-width:1100px;padding:20px}.grayscale-group .opera[data-v-fe10ed0a]{height:91px;margin-bottom:15px}.grayscale-group .opera button[disabled][data-v-fe10ed0a]{color:#ccc;cursor:not-allowed}.grayscale-group .opera .active[data-v-fe10ed0a]{border-color:#4285f4;color:#4285f4}.grayscale-group .opera .top[data-v-fe10ed0a]{height:30px;color:#333;padding-bottom:15px;border-bottom:1px solid #cbcbcb;margin-bottom:15px}.grayscale-group .opera .top a[data-v-fe10ed0a],.grayscale-group .opera .top span[data-v-fe10ed0a]{font-size:14px;line-height:30px}.grayscale-group .opera .top span[data-v-fe10ed0a]{color:#4285f4;padding-left:30px;background:url("+a("2W3E")+") 5px 50% no-repeat}.grayscale-group .nograyscale-group[data-v-fe10ed0a]{line-height:100px;text-align:center;font-size:16px}.grayscale-group .nograyscale-group i[data-v-fe10ed0a]{margin-right:10px}.grayscale-group dd[data-v-fe10ed0a],.grayscale-group dt[data-v-fe10ed0a]{line-height:30px;margin-bottom:15px;float:left}.grayscale-group dt[data-v-fe10ed0a]{width:100px}.grayscale-group dt i[data-v-fe10ed0a]{color:red;margin-left:5px}.grayscale-group dd[data-v-fe10ed0a]{width:460px}.grayscale-group dd textarea[data-v-fe10ed0a]{width:400px;height:100px;padding:5px 10px;resize:none}.grayscale-group .addgrayscale-group .select[data-v-fe10ed0a]{width:400px}.grayscale-group .pushinstance .select[data-v-fe10ed0a]{width:560px}.grayscale-group .pushinstance p[data-v-fe10ed0a]{height:30px;line-height:30px}.grayscale-group .pushconf>p>i[data-v-fe10ed0a]{margin-left:10px;cursor:pointer}.grayscale-group .pushconf .basetxt input[type=text][data-v-fe10ed0a]{width:140px}.grayscale-group .servicesubuscriber .title[data-v-fe10ed0a]{height:30px;line-height:30px}.grayscale-group .servicesubuscriber .select[data-v-fe10ed0a]{width:90%;margin-bottom:20px}.el-icon-loading[data-v-fe10ed0a]{color:#000;margin-right:5px}","",{version:3,sources:["D:/admin/config/src/components/config_center/grayscale_group.vue"],names:[],mappings:"AACA,kCACE,iBAAkB,AAClB,YAAc,CACf,AACD,yCACE,YAAa,AACb,kBAAoB,CACrB,AACD,0DACE,WAAY,AACZ,kBAAoB,CACrB,AACD,iDACE,qBAAsB,AACtB,aAAe,CAChB,AACD,8CACE,YAAa,AACb,WAAY,AACZ,oBAAqB,AACrB,gCAAiC,AACjC,kBAAoB,CACrB,AACD,mGAEE,eAAgB,AAChB,gBAAkB,CACnB,AACD,mDACE,cAAe,AACf,kBAAmB,AACnB,0DAAqE,CACtE,AACD,qDACE,kBAAmB,AACnB,kBAAmB,AACnB,cAAgB,CACjB,AACD,uDACE,iBAAmB,CACpB,AACD,0EAEE,iBAAkB,AAClB,mBAAoB,AACpB,UAAY,CACb,AACD,qCACE,WAAa,CACd,AACD,uCACE,UAAY,AACZ,eAAiB,CAClB,AACD,qCACE,WAAa,CACd,AACD,8CACE,YAAa,AACb,aAAc,AACd,iBAAkB,AAClB,WAAa,CACd,AACD,8DACE,WAAa,CACd,AACD,wDACE,WAAa,CACd,AACD,kDACE,YAAa,AACb,gBAAkB,CACnB,AACD,gDACE,iBAAkB,AAClB,cAAgB,CACjB,AACD,sEACE,WAAa,CACd,AACD,6DACE,YAAa,AACb,gBAAkB,CACnB,AACD,8DACE,UAAW,AACX,kBAAoB,CACrB,AACD,kCACE,WAAY,AACZ,gBAAkB,CACnB",file:"grayscale_group.vue",sourcesContent:['\n.grayscale-group[data-v-fe10ed0a] {\n  min-width: 1100px;\n  padding: 20px;\n}\n.grayscale-group .opera[data-v-fe10ed0a] {\n  height: 91px;\n  margin-bottom: 15px;\n}\n.grayscale-group .opera button[disabled][data-v-fe10ed0a] {\n  color: #ccc;\n  cursor: not-allowed;\n}\n.grayscale-group .opera .active[data-v-fe10ed0a] {\n  border-color: #4285f4;\n  color: #4285f4;\n}\n.grayscale-group .opera .top[data-v-fe10ed0a] {\n  height: 30px;\n  color: #333;\n  padding-bottom: 15px;\n  border-bottom: 1px solid #cbcbcb;\n  margin-bottom: 15px;\n}\n.grayscale-group .opera .top a[data-v-fe10ed0a],\n.grayscale-group .opera .top span[data-v-fe10ed0a] {\n  font-size: 14px;\n  line-height: 30px;\n}\n.grayscale-group .opera .top span[data-v-fe10ed0a] {\n  color: #4285f4;\n  padding-left: 30px;\n  background: url("~common/image/icon/arrow_11.png") 5px 50% no-repeat;\n}\n.grayscale-group .nograyscale-group[data-v-fe10ed0a] {\n  line-height: 100px;\n  text-align: center;\n  font-size: 16px;\n}\n.grayscale-group .nograyscale-group i[data-v-fe10ed0a] {\n  margin-right: 10px;\n}\n.grayscale-group dt[data-v-fe10ed0a],\n.grayscale-group dd[data-v-fe10ed0a] {\n  line-height: 30px;\n  margin-bottom: 15px;\n  float: left;\n}\n.grayscale-group dt[data-v-fe10ed0a] {\n  width: 100px;\n}\n.grayscale-group dt i[data-v-fe10ed0a] {\n  color: #f00;\n  margin-left: 5px;\n}\n.grayscale-group dd[data-v-fe10ed0a] {\n  width: 460px;\n}\n.grayscale-group dd textarea[data-v-fe10ed0a] {\n  width: 400px;\n  height: 100px;\n  padding: 5px 10px;\n  resize: none;\n}\n.grayscale-group .addgrayscale-group .select[data-v-fe10ed0a] {\n  width: 400px;\n}\n.grayscale-group .pushinstance .select[data-v-fe10ed0a] {\n  width: 560px;\n}\n.grayscale-group .pushinstance p[data-v-fe10ed0a] {\n  height: 30px;\n  line-height: 30px;\n}\n.grayscale-group .pushconf >p >i[data-v-fe10ed0a] {\n  margin-left: 10px;\n  cursor: pointer;\n}\n.grayscale-group .pushconf .basetxt input[type=text][data-v-fe10ed0a] {\n  width: 140px;\n}\n.grayscale-group .servicesubuscriber .title[data-v-fe10ed0a] {\n  height: 30px;\n  line-height: 30px;\n}\n.grayscale-group .servicesubuscriber .select[data-v-fe10ed0a] {\n  width: 90%;\n  margin-bottom: 20px;\n}\n.el-icon-loading[data-v-fe10ed0a] {\n  color: #000;\n  margin-right: 5px;\n}'],sourceRoot:""}])},"2W3E":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAAXNSR0IArs4c6QAAAJ5JREFUKBVjYMAHav4r4pJmwiXBUPvfnOE/w3mG6v8TsanBrfE/gyBQAwcQ52HTjFtjC+MOBmaGQKDGn9g0MwIF8YO6/54MfxnWAxWxA/EkhlbGfJAGwhpBqrBoJk4jFs24/QhSjAcQZyNZTsWiCeQQ/Dbi0IRfY81/D2DK2QBUhBINIE0gwAKhsJCMDO+BGn8AZWbC4g6LKhxCeBI5AH2EN+zEAAKYAAAAAElFTkSuQmCC"},"rxJ+":function(e,t,a){"use strict";function s(e){var t=m+"v1/instanceManage/detail"+e;return h.a.get(t).then(function(e){return d.a.resolve(e.data)})}function n(e){var t=m+"v1/instanceManage/appointList"+e;return h.a.get(t).then(function(e){return d.a.resolve(e.data)})}function i(e){var t=m+"v1/instanceManage/edit";return h.a.post(t,e).then(function(e){return d.a.resolve(e.data)})}function o(e){a("uVvA")}Object.defineProperty(t,"__esModule",{value:!0});var r=a("Dd8w"),c=a.n(r),l=a("mvHQ"),u=a.n(l),p=a("T452"),g=a("//Fk"),d=a.n(g),h=a("/R87"),m="api/",f=a("hCGe"),v=a("NYxO"),C={data:function(){return{projectName:"",clusterName:"",serviceName:"",versionName:"",versionId:"",group:"",groupName:"",groupList:[],grayscaleConfList:[],addGrayscaleGroupDialog:!1,pushInstanceDialog:!1,addConfDialog:!1,pushConfDialog:!1,serviceSubscriberDialog:!1,batchSelect:[],grayscaleName:"",grayscaleDesc:"",grayscaleConf:[],conf:[],confList:[],uploadFiles:[],addPushInstance:[],instance:[],instanceList:[],pushInstance:[],pushInstanceList:[],pushInstanceListTemp:[],inputNum:500,confDesc:"",ssCurrentPage:1,ssPageSize:10,ssTotalCount:0,regionList:[],addRegionIndex:0,selectRegion:"",selectRegionList:[],currentSelectConf:"",currentBatchConf:[],pushConfType:"",serviceSubscriber:[],userInfoData:{},isGetting:!1,isGettingText:"确认"}},methods:{_getGrayscaleGroup:function(e){var t=this;Object(p.p)("?versionId="+this.versionId).then(function(a){if(0!==a.code)t.$message({message:a.message?a.message:"获取灰度组失败",type:"error"});else if(a.data.list.length){t.groupList=a.data.list;var s=0;e&&(s=t.groupList.findIndex(function(t){return t.name===e})),t.group=t.groupList[s].id,t.groupName=t.groupList[s].name,t.getGrayscaleGroupDetails()}else t.groupList=[],t.group="",t.groupName=""})},getGrayscaleGroupDetails:function(){var e=this;Object(p.q)("?id="+this.group).then(function(t){0!==t.code?e.$message({message:t.message?t.message:"获取灰度组配置失败",type:"error"}):(t.data.configs?e.grayscaleConfList=t.data.configs:e.grayscaleConfList=[],e.groupName=e.groupList.filter(function(t){return t.id===e.group})[0].name)})},_getLatestConfigList:function(){var e=this;Object(p.r)({isPage:"0"}).then(function(t){if(0!==t.code)e.$message({message:t.message?t.message:"获取推送实例列表失败",type:"error"});else if(t.data.list){e.confList=t.data.list;var a=[];e.confList.forEach(function(e){a.push(e.id)}),e.conf=a}})},handleSelectionChange:function(e){this.batchSelect=e},addGrayscaleGroupOpera:function(){this._queryInstanceByVer(),this._getLatestConfigList(),this.addGrayscaleGroupDialog=!0},uploadFileChange:function(e,t){e.size?e.size>1048576?(t.splice(t.length-1,1),this.$message({message:e.name+"大小已超出1M，请重新选择",type:"error"})):/[\u4e00-\u9fa5]/.test(e.name)?(t.splice(t.length-1,1),this.$message({message:"请勿上传中文文件名的配置文件",type:"error"})):t.filter(function(t){return t.name===e.name}).length>1&&(t.splice(t.length-1,1),this.$message({message:"请勿上传文件名相同的配置文件",type:"error"})):(t.splice(t.length-1,1),this.$message({message:e.name+"为空文件，请重新选择",type:"error"}))},uploadFileNum:function(e,t){this.$message({message:"最多支持上传10个文件，当前选择了"+e.length+"个文件，共选择了"+(e.length+t.length)+"个文件",type:"error"})},inputNumChange:function(e){var t=this,a=setTimeout(function(s){t.inputNum=500-t.$refs[e].value.length,clearTimeout(a)},300)},closeDialog:function(e){switch(e){case"grayscale":this.grayscaleName="",this.grayscaleDesc="",this.grayscaleConf=[],this.uploadFiles=[],this.instance=[];break;case"pushInstance":this.addPushInstance="",this.pushInstanceListTemp=[];break;case"conf":this.confDesc="",this.uploadFiles=[]}this.inputNum=500,this.requestCompleted()},addGrayscaleGroup:function(){var e=this;if(this.grayscaleName){var t=this.$refs.addGrayscale.uploadFiles,a=new FormData;a.append("project",this.projectName),a.append("cluster",this.clusterName),a.append("service",this.serviceName),a.append("version",this.versionName),a.append("versionId",this.versionId),a.append("name",this.grayscaleName),a.append("desc",this.grayscaleDesc),a.append("ids",this.conf||[]),a.append("content",this.instance.join(",")||""),t.map(function(e){a.append("file",e.raw)}),this.requestIn(),Object(p.b)(a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(a){e.addGrayscaleGroupDialog=!1,0!==a.code?e.$message({message:a.message?a.message:"新增灰度组失败",type:"error"}):(e._getGrayscaleGroup(e.grayscaleName),(e.conf.length||t.length)&&(e.pushConfType="addGrayGroup",e.pushConfDialog=!0),e.$message({message:a.data.grayGroup.name+"新增成功",type:"success"}))})}else this.$message({message:"请输入灰度组名称",type:"error"})},delGrayscaleGroup:function(){var e=this;this.$confirm("此操作会同步删除灰度组添加的所有配置文件，确认删除"+this.groupName+"？","删除提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(t){var a=e.$loading({lock:!0,text:"正在删除，请稍后",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});Object(p.g)({project:e.projectName,cluster:e.clusterName,service:e.serviceName,version:e.versionName,grayId:e.group}).then(function(t){0!==t.code?e.$message({message:t.message?t.message:"删除灰度组失败",type:"error"}):(e.$message({message:"删除灰度组成功",type:"success"}),e._getGrayscaleGroup()),a.close()})}).catch(function(e){})},addConfs:function(){var e=this,t=this.$refs.addConf.uploadFiles;if(t.length>0){this.currentBatchConf=[];var a=new FormData;a.append("project",this.projectName),a.append("cluster",this.clusterName),a.append("service",this.serviceName),a.append("version",this.versionName),a.append("versionId",this.versionId),a.append("grayId",this.group),a.append("name",this.groupName),a.append("desc",this.confDesc),t.forEach(function(e){a.append("file",e.raw)}),this.requestIn(),Object(p.a)(a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){e.addConfDialog=!1,0!==t.code?e.$message({message:t.message?t.message:"新增灰度组失败",type:"error"}):(e.getGrayscaleGroupDetails(),t.data.serviceConfigList&&t.data.serviceConfigList.forEach(function(t){e.currentBatchConf.push(t.id)}),e.pushConfType="addConf",e.pushConfDialog=!0,e.$message({message:"新增配置成功",type:"success"}))})}else this.$message({message:"请先选择文件",type:"error"})},downloadConf:function(e){Object(p.i)("?id="+e.id).then(function(e){var t=document,a=t.createElement("a");a.download=e.data.fileName,a.style.display="none";var s=new Blob([e.data.content]);a.href=URL.createObjectURL(s),t.body.appendChild(a),a.click(),t.body.removeChild(a)})},deleteConfig:function(e){var t=this;this.$confirm("确认删除 "+e.name+" 吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(a){Object(p.h)({id:e.id}).then(function(a){0!==a.code?t.$message({message:a.message?a.message:"删除配置失败",type:"error"}):(t.$message({message:e.name+" 删除成功",type:"success"}),t.getGrayscaleGroupDetails())})}).catch(function(e){})},batchDeleteConfig:function(e){var t=this;if(this.batchSelect.length){var a=[],s=[];this.batchSelect.forEach(function(e){a.push(e.id),s.push(e.name)}),this.$confirm("确认批量删除 "+s.join("，")+" 吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(e){Object(p.d)({ids:a}).then(function(e){0!==e.code?t.$message({message:e.message?e.message:"删除配置失败",type:"error"}):(t.$message({message:"删除配置成功",type:"success"}),t.getGrayscaleGroupDetails())})}).catch(function(e){})}else this.$message({message:"请先勾选要批量删除的配置",type:"error"})},pushInstanceOpera:function(){this._queryInstanceDetails(),this._queryInstanceByVer(this.group),this.pushInstanceDialog=!0},_queryInstanceByVer:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0";n("?project="+this.projectName+"&cluster="+this.clusterName+"&service="+this.serviceName+"&version="+this.versionName+"&versionId="+this.versionId+"&grayId="+t).then(function(t){0!==t.code?e.$message({message:t.message?t.message:"获取推送实例列表失败",type:"error"}):t.data?e.instanceList=t.data.split(","):(e.instanceList=[],e.instance=[])})},_queryInstanceDetails:function(){var e=this;this.group&&s("?grayId="+this.group).then(function(t){0!==t.code?e.$message({message:t.message?t.message:"获取推送实例列表失败",type:"error"}):t.data?(e.pushInstanceList=t.data.split(","),e.pushInstance=JSON.parse(u()(e.pushInstanceList))):(e.pushInstanceList=[],e.pushInstance=[])})},addInstance:function(){return this.addPushInstance.length?-1!==this.pushInstance.indexOf(this.addPushInstance)?(this.$message({message:this.addPushInstance+"已存在，请重新输入",type:"error"}),!1):(this.pushInstance.push(this.addPushInstance),this.pushInstanceListTemp.push(this.addPushInstance),void(this.addPushInstance="")):(this.$message({message:"请输入要添加的实例",type:"error"}),!1)},editInstance:function(){var e=this;this.requestIn(),i({grayId:this.group,versionId:this.versionId,content:this.pushInstance.join(",")||""}).then(function(t){0!==t.code?(e.requestCompleted(),e.$message({message:t.message?t.message:"添加推送实例失败",type:"error"})):(e.pushInstanceDialog=!1,e._queryInstanceDetails(),e.$message({message:"保存成功",type:"success"}))})},delPushInstance:function(e){this.pushInstanceList.splice(this.pushInstanceList.indexOf(e),1)},cancelInstance:function(){var e=this;this.pushInstanceListTemp.forEach(function(t){e.pushInstanceList.splice(e.pushInstanceList.indexOf(t),1)}),this.pushInstanceDialog=!1},getRegionList:function(){var e=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object(f.O)({isPage:0}).then(function(t){0!==t.code?e.$message({message:t.message?t.message:"获取推送区域列表失败",type:"type"}):t.data.list&&(e.regionList=t.data.list)})},handleSelectionChangeForPush:function(e){this.selectRegionList=e},addRegionList:function(){this.regionList[this.regionList.length-1].createTime&&(this.addRegionIndex=this.regionList.length,this.regionList.push({name:"",pushUrl:""}))},cancelAdd:function(){this.regionList.splice(this.addRegionIndex,1)},addRegion:function(e){var t=this;e.name&&e.pushUrl?Object(f.e)({name:e.name,pushUrl:e.pushUrl}).then(function(e){0!==e.code?t.$message({message:e.message?e.message:"推送区域添加失败",type:"error"}):(t.$message({message:"添加成功",type:"success"}),t.getRegionList())}):this.$message({message:"请输入要添加的区域和推送地址",type:"error"})},batchPushForRegion:function(){this.batchSelect.length?(this.pushConfType="batch",this.pushConfDialog=!0):this.$message({message:"请先勾选要批量推送的配置",type:"error"})},pushConf:function(){var e=[];if(!this.selectRegionList.length)return this.$message({message:"请选择推送区域",type:"error"}),!1;this.selectRegionList.forEach(function(t){e.push(t.id)});var t=[];switch(this.requestIn(),this.pushConfType){case"single":this._pushGrayscale(e);break;case"batch":this.batchSelect.forEach(function(e){t.push(e.id)}),this._batchPushGrayscale(t,e,!0);break;case"addGrayGroup":this.grayscaleConfList.forEach(function(e){t.push(e.id)}),this._batchPushGrayscale(t,e);break;case"addConf":this._batchPushGrayscale(this.currentBatchConf||[],e)}},_pushGrayscale:function(e){var t=this;Object(p.v)({id:this.currentSelectConf||"",regionIds:e}).then(function(e){if(0!==e.code)t.$message({message:e.message?e.message:"配置推送失败",type:"error"});else if(e.data.regions){var a=e.data.regions.filter(function(e){return 1===e.successed}).length;a?t.$message({message:"推送成功",type:"success"}):t.$message({message:"推送失败",type:"error"})}t.pushConfDialog=!1})},_batchPushGrayscale:function(e,t,a){var s=this;Object(p.e)({ids:e,regionIds:t}).then(function(e){if(0!==e.code)s.$message({message:e.message?e.message:"配置推送失败",type:"error"});else if(e.data.regions){var t=e.data.regions.filter(function(e){return 1===e.successed}).length;t?(s.$message({message:"推送成功",type:"success"}),a&&s.$refs.pushTable.clearSelection()):s.$message({message:"推送失败",type:"error"})}s.pushConfDialog=!1,s.currentBatchConf=[]})},getGrayscaleConsumer:function(){var e=this;Object(p.o)("?project="+this.projectName+"&cluster="+this.clusterName+"&service="+this.serviceName+"&version="+this.versionName+"&region="+this.selectRegion+"&grayId="+this.group+"&isPage=1&currentPage="+this.ssCurrentPage+"&pagesize="+this.ssPageSize).then(function(t){0!==t.code?e.$message({message:t.message?t.message:"获取订阅者列表失败",type:"error"}):t.data.list?(e.serviceSubscriber=t.data.list,e.serviceSubscriber.map(function(e,t){e.index=t+1}),e.ssTotalCount=t.data.totalCount):e.$message({message:"该区域暂无订阅者",type:"error"})})},ssCurrentChange:function(){this.getGrayscaleConsumer()},closeserviceSubscriber:function(){this.selectRegion="",this.serviceSubscriber=[],this.ssTotalCount=0,this.ssCurrentChange=1},requestIn:function(){this.isGetting=!0,this.isGettingText="处理中"},requestCompleted:function(){this.isGetting=!1,this.isGettingText="确认"}},created:function(){this.projectName=this.$route.query.project,this.clusterName=this.$route.query.cluster,this.serviceName=this.$route.query.service,this.versionName=this.$route.query.version,this.versionId=this.$route.query.versionId,this._getGrayscaleGroup(),this.userInfoData=JSON.parse(this.userInfo)},computed:c()({},Object(v.b)(["userInfo"])),mounted:function(){sessionStorage.getItem("EDITCONF")?(this.currentSelectConf=sessionStorage.getItem("EDITCONF"),this.pushConfType="single",this.pushConfDialog=!0,sessionStorage.removeItem("EDITCONF")):sessionStorage.getItem("RBCONF")&&(this.currentBatchConf=sessionStorage.getItem("RBCONF").split(",")||[],this.pushConfType="addConf",this.pushConfDialog=!0,sessionStorage.removeItem("RBCONF"))}},A=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"grayscale-group"},[a("div",{staticClass:"opera"},[a("h2",{staticClass:"top"},[a("router-link",{staticClass:"lan",attrs:{to:"/main/config"}},[e._v("配置中心")]),e._v(" "),a("span",[e._v("灰度发布")]),e._v(" "),a("div",{staticClass:"groups r"},[e._v("\n        灰度组：\n        "),a("el-select",{on:{change:e.getGrayscaleGroupDetails},model:{value:e.group,callback:function(t){e.group=t},expression:"group"}},e._l(e.groupList,function(e,t){return a("el-option",{key:t,attrs:{value:e.id,label:e.name}})}))],1)],1),e._v(" "),a("div",{staticClass:"basebtn l"},[a("button",{staticClass:"lan",attrs:{type:"button"},on:{click:e.addGrayscaleGroupOpera}},[e._v("新增灰度组")]),e._v(" "),a("button",{class:{active:e.groupName},attrs:{type:"button",disabled:!e.groupName},on:{click:e.pushInstanceOpera}},[e._v("推送实例管理")]),e._v(" "),a("button",{class:{active:e.groupName},attrs:{type:"button",disabled:!e.groupName},on:{click:e.delGrayscaleGroup}},[e._v("删除灰度组")]),e._v(" "),a("button",{class:{active:e.groupName},attrs:{type:"button",disabled:!e.groupName},on:{click:function(t){e.addConfDialog=!0}}},[e._v("新增配置")]),e._v(" "),a("router-link",{class:{active:e.groupName},attrs:{tag:"button",to:"/main/config/grayscale_history?project="+e.projectName+"&cluster="+e.clusterName+"&service="+e.serviceName+"&version="+e.versionName+"&versionId="+e.versionId+"&gray="+e.groupName,disabled:!e.groupName}},[e._v("历史配置")]),e._v(" "),a("button",{class:{active:e.groupName},attrs:{type:"button",disabled:!e.groupName},on:{click:function(t){e.serviceSubscriberDialog=!0}}},[e._v("查看订阅者")]),e._v(" "),a("button",{class:{active:e.groupName},attrs:{type:"button",disabled:!e.groupName},on:{click:e.batchPushForRegion}},[e._v("批量推送")]),e._v(" "),a("button",{class:{active:e.groupName},attrs:{type:"button",disabled:!e.groupName},on:{click:e.batchDeleteConfig}},[e._v("批量删除")])],1)]),e._v(" "),a("el-table",{directives:[{name:"show",rawName:"v-show",value:e.groupList.length,expression:"groupList.length"}],staticClass:"table",staticStyle:{width:"100%"},attrs:{data:e.grayscaleConfList,stripe:""},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"60"}}),e._v(" "),a("el-table-column",{attrs:{label:"配置名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("router-link",{staticClass:"lan",attrs:{to:"/main/config/grayscale_history_version?project="+e.projectName+"&cluster="+e.clusterName+"&service="+e.serviceName+"&version="+e.versionName+"&gray="+e.groupName+"&name="+t.row.name+"&id="+t.row.id}},[e._v(e._s(t.row.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"配置路径",prop:"path"}}),e._v(" "),a("el-table-column",{attrs:{label:"配置描述",prop:"desc"}}),e._v(" "),a("el-table-column",{attrs:{label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.createTime?(new Date).Format("yyyy-MM-dd hh:mm:ss"):"-"))]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"更新时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.updateTime?(new Date).Format("yyyy-MM-dd hh:mm:ss"):"-"))]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("router-link",{staticClass:"lan",attrs:{to:"/main/config/grayscale_edit?project="+e.projectName+"&cluster="+e.clusterName+"&service="+e.serviceName+"&version="+e.versionName+"&versionId="+e.versionId+"&gray="+e.groupName+"&name="+t.row.name+"&id="+t.row.id}},[e._v("编辑")]),e._v(" "),a("a",{staticClass:"lan",attrs:{href:"javascript:;"},on:{click:function(a){e.currentSelectConf=t.row.id,e.pushConfType="single",e.pushConfDialog=!0}}},[e._v("推送")]),e._v(" "),a("a",{staticClass:"lan",attrs:{href:"javascript:;"},on:{click:function(a){e.downloadConf(t.row)}}},[e._v("下载")]),e._v(" "),a("a",{staticClass:"lan",attrs:{href:"javascript:;"},on:{click:function(a){e.deleteConfig(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.groupList.length,expression:"!groupList.length"}],staticClass:"nograyscale-group"},[a("i",{staticClass:"el-icon-warning"}),e._v("该服务版本下无灰度小组，请先新增灰度小组")]),e._v(" "),a("el-dialog",{attrs:{title:"新增灰度组",visible:e.addGrayscaleGroupDialog,width:"600px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.addGrayscaleGroupDialog=t},close:function(t){e.closeDialog("grayscale")}}},[a("div",{staticClass:"addgrayscale-group"},[a("dl",[a("dt",[e._v("灰度组名称"),a("i",[e._v("*")])]),e._v(" "),a("dd",{staticClass:"basetxt"},[a("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.grayscaleName,expression:"grayscaleName",modifiers:{trim:!0}}],attrs:{type:"text"},domProps:{value:e.grayscaleName},on:{input:function(t){t.target.composing||(e.grayscaleName=t.target.value.trim())},blur:function(t){e.$forceUpdate()}}})]),e._v(" "),a("dt",[e._v("灰度组描述")]),e._v(" "),a("dd",{staticClass:"basetxt"},[a("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:e.grayscaleDesc,expression:"grayscaleDesc",modifiers:{trim:!0}}],ref:"grayscaleDesc",attrs:{maxlength:"500"},domProps:{value:e.grayscaleDesc},on:{input:[function(t){t.target.composing||(e.grayscaleDesc=t.target.value.trim())},function(t){e.inputNumChange("grayscaleDesc")}],blur:function(t){e.$forceUpdate()}}}),e._v(" "),a("p",[e._v("你还可以输入"),a("span",[e._v(e._s(e.inputNum)+"个字符")])])]),e._v(" "),a("dt",[e._v("推送实例列表")]),e._v(" "),a("dd",[a("el-select",{staticClass:"select",attrs:{multiple:"",filterable:"","allow-create":"","default-first-option":""},model:{value:e.instance,callback:function(t){e.instance=t},expression:"instance"}},e._l(e.instanceList,function(e,t){return a("el-option",{key:t,attrs:{value:e,label:e}})}))],1),e._v(" "),a("dt",[e._v("配置文件")]),e._v(" "),a("dd",[a("span",[e._v("请选择需要同步当前正常组版本的配置文件：")]),a("br"),e._v(" "),a("el-select",{staticClass:"select",attrs:{multiple:""},model:{value:e.conf,callback:function(t){e.conf=t},expression:"conf"}},e._l(e.confList,function(e,t){return a("el-option",{key:t,attrs:{value:e.id,label:e.name}})})),a("br"),e._v(" "),a("span",[e._v("添加其他配置文件：")]),a("br")],1)]),e._v(" "),a("el-upload",{ref:"addGrayscale",staticClass:"upload-demo",attrs:{drag:"",multiple:"",action:"api/api/v1/gray/add","auto-upload":!1,"file-list":e.uploadFiles,"on-change":e.uploadFileChange,limit:10,"on-exceed":e.uploadFileNum}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[e._v("文件拖到此处，或"),a("em",[e._v("点击上传")])]),e._v(" "),a("div",{staticClass:"el-upload__tips",attrs:{slot:"tip"},slot:"tip"},[e._v("支持多文件上传，单个文件大小最大为1M，最多同时支持10个文件")])])],1),e._v(" "),a("span",{staticClass:"dialog-footer basebtn r",attrs:{slot:"footer"},slot:"footer"},[a("button",{attrs:{type:"button"},on:{click:function(t){e.addGrayscaleGroupDialog=!1}}},[e._v("取消")]),e._v(" "),a("button",{staticClass:"lan",attrs:{type:"button",disabled:e.isGetting},on:{click:e.addGrayscaleGroup}},[e.isGetting?a("i",{staticClass:"el-icon-loading"}):e._e(),e._v(e._s(e.isGettingText)+"\n      ")])])]),e._v(" "),a("el-dialog",{attrs:{title:"推送实例管理",visible:e.pushInstanceDialog,width:"600px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.pushInstanceDialog=t},close:function(t){e.closeDialog("pushInstance")}}},[a("div",{staticClass:"pushinstance"},[a("p",[e._v("支持模糊搜索")]),e._v(" "),a("el-select",{staticClass:"select",attrs:{multiple:"",filterable:""},on:{"remove-tag":e.delPushInstance},model:{value:e.pushInstance,callback:function(t){e.pushInstance=t},expression:"pushInstance"}},e._l(e.instanceList,function(e,t){return a("el-option",{key:t,attrs:{value:e,label:e}})})),e._v(" "),a("p",[e._v("自定义添加")]),e._v(" "),a("p",{staticClass:"basetxt basebtn"},[a("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.addPushInstance,expression:"addPushInstance",modifiers:{trim:!0}}],staticClass:"l",attrs:{type:"text"},domProps:{value:e.addPushInstance},on:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.addInstance(t)},input:function(t){t.target.composing||(e.addPushInstance=t.target.value.trim())},blur:function(t){e.$forceUpdate()}}}),a("button",{staticClass:"l lan",attrs:{type:"button"},on:{click:e.addInstance}},[e._v("添加")])])],1),e._v(" "),a("span",{staticClass:"dialog-footer basebtn r",attrs:{slot:"footer"},slot:"footer"},[a("button",{attrs:{type:"button"},on:{click:e.cancelInstance}},[e._v("取消")]),e._v(" "),a("button",{staticClass:"lan",attrs:{type:"button",disabled:e.isGetting},on:{click:e.editInstance}},[e.isGetting?a("i",{staticClass:"el-icon-loading"}):e._e(),e._v(e._s(e.isGettingText)+"\n      ")])])]),e._v(" "),a("el-dialog",{attrs:{title:"新增配置",visible:e.addConfDialog,width:"600px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.addConfDialog=t},close:function(t){e.closeDialog("conf")}}},[a("div",{staticClass:"addconf"},[a("dl",[a("dt",[e._v("灰度组名称")]),e._v(" "),a("dd",[e._v(e._s(e.groupName))]),e._v(" "),a("dt",[e._v("配置描述")]),e._v(" "),a("dd",{staticClass:"basetxt"},[a("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:e.confDesc,expression:"confDesc",modifiers:{trim:!0}}],ref:"confDesc",attrs:{maxlength:"500"},domProps:{value:e.confDesc},on:{input:[function(t){t.target.composing||(e.confDesc=t.target.value.trim())},function(t){e.inputNumChange("confDesc")}],blur:function(t){e.$forceUpdate()}}}),e._v(" "),a("p",[e._v("你还可以输入"),a("span",[e._v(e._s(e.inputNum)+"个字符")])])])]),e._v(" "),a("el-upload",{ref:"addConf",staticClass:"upload-demo",attrs:{drag:"",multiple:"",action:"api/api/v1/grayConfig/addGrayConfig","auto-upload":!1,"file-list":e.uploadFiles,"on-change":e.uploadFileChange,limit:10,"on-exceed":e.uploadFileNum}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[e._v("文件拖到此处，或"),a("em",[e._v("点击上传")])]),e._v(" "),a("div",{staticClass:"el-upload__tips",attrs:{slot:"tip"},slot:"tip"},[e._v("支持多文件上传，单个文件大小最大为1M，最多同时支持10个文件")])])],1),e._v(" "),a("span",{staticClass:"dialog-footer basebtn r",attrs:{slot:"footer"},slot:"footer"},[a("button",{attrs:{type:"button"},on:{click:function(t){e.addConfDialog=!1}}},[e._v("取消")]),e._v(" "),a("button",{staticClass:"lan",attrs:{type:"button",disabled:e.isGetting},on:{click:e.addConfs}},[e.isGetting?a("i",{staticClass:"el-icon-loading"}):e._e(),e._v(e._s(e.isGettingText)+"\n      ")])])]),e._v(" "),a("el-dialog",{attrs:{title:"推送配置",visible:e.pushConfDialog,width:"600px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.pushConfDialog=t},open:function(t){e.getRegionList()},close:function(t){e.requestCompleted()}}},[a("div",{staticClass:"pushconf"},[a("p",[e._v("选择推送的目标区域"),1===e.userInfoData.roleType?a("i",{staticClass:"el-icon-circle-plus",on:{click:e.addRegionList}}):e._e()]),e._v(" "),a("el-table",{ref:"pushTable",staticClass:"table",staticStyle:{width:"100%"},attrs:{data:e.regionList,stripe:""},on:{"selection-change":e.handleSelectionChangeForPush}},[a("el-table-column",{attrs:{type:"selection",width:"60"}}),e._v(" "),a("el-table-column",{attrs:{label:"区域"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.createTime?a("span",[e._v(e._s(t.row.name))]):a("p",{staticClass:"basetxt"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.row.name,expression:"scope.row.name"}],attrs:{type:"text"},domProps:{value:t.row.name},on:{input:function(a){a.target.composing||e.$set(t.row,"name",a.target.value)}}})])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"companion"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.createTime?a("span",[e._v(e._s(t.row.pushUrl))]):a("p",{staticClass:"basetxt"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.row.pushUrl,expression:"scope.row.pushUrl"}],attrs:{type:"text"},domProps:{value:t.row.pushUrl},on:{input:function(a){a.target.composing||e.$set(t.row,"pushUrl",a.target.value)}}})])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.createTime?e._e():a("div",{staticClass:"basebtn"},[a("button",{staticClass:"lan",on:{click:function(a){e.addRegion(t.row)}}},[e._v("添加")]),a("button",{attrs:{type:"button"},on:{click:e.cancelAdd}},[e._v("取消")])])]}}])})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer basebtn r",attrs:{slot:"footer"},slot:"footer"},[a("button",{attrs:{type:"button"},on:{click:function(t){e.pushConfDialog=!1}}},[e._v("取消")]),e._v(" "),a("button",{staticClass:"lan",attrs:{type:"button",disabled:e.isGetting},on:{click:e.pushConf}},[e.isGetting?a("i",{staticClass:"el-icon-loading"}):e._e(),e._v(e._s(e.isGettingText)+"\n      ")])])]),e._v(" "),a("el-dialog",{attrs:{title:"查看服务订阅者",visible:e.serviceSubscriberDialog,width:"500px"},on:{"update:visible":function(t){e.serviceSubscriberDialog=t},open:function(t){e.getRegionList("region")},close:e.closeserviceSubscriber}},[a("div",{staticClass:"servicesubuscriber"},[a("div",{staticClass:"title"},[a("span",{staticClass:"l"},[e._v("区域：")]),e._v(" "),a("el-select",{staticClass:"l select",attrs:{placeholder:"请选择查看订阅者区域"},on:{change:e.getGrayscaleConsumer},model:{value:e.selectRegion,callback:function(t){e.selectRegion=t},expression:"selectRegion"}},e._l(e.regionList,function(t,s){return a("el-option",{key:s,attrs:{label:t.name,value:t.name}},[a("span",{staticClass:"l"},[e._v(e._s(t.name))]),e._v(" "),a("span",{staticClass:"r"},[e._v(e._s(t.pushUrl))])])}))],1),e._v(" "),a("el-table",{staticClass:"table",staticStyle:{width:"100%"},attrs:{data:e.serviceSubscriber,stripe:""}},[a("el-table-column",{attrs:{label:"编号",prop:"index"}}),e._v(" "),a("el-table-column",{attrs:{label:"地址",prop:"addr"}})],1),e._v(" "),e.ssTotalCount>e.ssPageSize?a("div",{staticClass:"basePagenate"},[a("el-pagination",{attrs:{"current-page":e.ssCurrentPage,"page-size":e.ssPageSize,layout:"total, prev, pager, next",total:e.ssTotalCount},on:{"current-change":e.ssCurrentChange,"update:currentPage":function(t){e.ssCurrentPage=t}}})],1):e._e()],1),e._v(" "),a("span",{staticClass:"dialog-footer basebtn r",attrs:{slot:"footer"},slot:"footer"},[a("button",{staticClass:"lan",attrs:{type:"button"},on:{click:function(t){e.serviceSubscriberDialog=!1}}},[e._v("关闭")])])])],1)},y=[],b={render:A,staticRenderFns:y},_=b,x=a("VU/8"),D=o,I=x(C,_,!1,D,"data-v-fe10ed0a",null);t.default=I.exports},uVvA:function(e,t,a){var s=a("2KBT");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);a("rjj0")("2b3448a2",s,!0)}});
//# sourceMappingURL=6.9453ad1e463e231a14fd.js.map